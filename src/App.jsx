import { useState } from "react";
import reactLogo from "./assets/react.svg";
import viteLogo from "/electron-vite.animate.svg";
import "./App.css";
import fs from "fs";
const electron = window.require("electron");
import axios from "axios";

function App() {
    const [count, setCount] = useState(0);

    const { ipcRenderer } = electron;
    let listFiles = [];

    function getFiles(folder, array, callback) {
        fs.readdir(folder, (err, files) => {
            if (err) {
                return callback(err);
            }

            if (files.length === 0) {
                return callback(null, array);
            }

            files.forEach((file) => {
                let filePath = folder + "/" + file;

                fs.stat(filePath, (err, stats) => {
                    if (err) {
                        return callback(err);
                    }

                    if (stats.isDirectory()) {
                        getFiles(filePath, array, (err, array) => {
                            if (err) {
                                return callback(err);
                            }

                            if (--files.length === 0) {
                                return callback(null, array);
                            }
                        });
                    } else {
                        array.push(filePath);

                        if (--files.length === 0) {
                            return callback(null, array);
                        }
                    }
                });
            });
        });
    }

    const openFolderDialog = () => {
        electron.ipcRenderer.send("open-folder-dialog");
    };

    ipcRenderer.on("folder-selected", (event, folderPath) => {
        console.log("Selected folder:", folderPath);

        getFiles(folderPath, listFiles, (err, array) => {
            if (err) {
                console.error(err);
            } else {
                console.log(array);
            }
        });
    });

    return (
        <>      
            <div className="container">

            </div>
            <button
                onClick={() => {
                    openFolderDialog();
                }}
            >
                Select Folder
            </button>

            <button
                onClick={async () => {
                    for (let i = 0; i < listFiles.length; i++) {
                        
                        const data = await axios.post("http://localhost:5000", {
                            filePath: listFiles[i],
                        });

                        console.log(data.data);
                    }
                }}
            >
                Scan
            </button>
        </>
    );
}

export default App;
