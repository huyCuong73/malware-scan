from flask_restful import Resource
from flask import request, jsonify
from context import Context

import yara
import json
import datetime



class YaraController(Resource):


    def get(self):
        data = request.json
        print(data)
        return '1223'

    # args: {userId:String, date:String, start:String, task:String}  
    def post(self):
        data = request.json
        # data_dict = json.loads(data)
        filePath = data['filePath']
        try:

            for rule in Context.compiledRules:
                if(rule.match(filePath)):
                    for r in rule:
                        # print(f"Matched rule: {r.identifier}")
                        if(r.identifier in ["FlyUtilsCnDES_ECB_Encrypt", "FGint_FindPrimeGoodCurveAndPoint", "FGint_ECElGamalEncrypt"]):
                            print("detected")


        except yara.Error as e:
            print(f"Error scanning file: {e}")
     
        return jsonify(data['filePath'])